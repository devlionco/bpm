YUI.add("moodle-course-toolboxes",function(e,t){var o={ACTIVITYINSTANCE:"activityinstance",AVAILABILITYINFODIV:"div.availabilityinfo",CONTENTWITHOUTLINK:"contentwithoutlink",CONDITIONALHIDDEN:"conditionalhidden",DIMCLASS:"dimmed",DIMMEDTEXT:"dimmed_text",EDITINSTRUCTIONS:"editinstructions",HIDE:"hide",MODINDENTCOUNT:"mod-indent-",MODINDENTHUGE:"mod-indent-huge",MODULEIDPREFIX:"module-",SECTIONHIDDENCLASS:"hidden",SECTIONIDPREFIX:"section-",SHOW:"editing_show"},i={ACTIONAREA:".actions",ACTIONLINKTEXT:".actionlinktext",ACTIVITYACTION:"a.cm-edit-action[data-action]",ACTIVITYICON:"img.activityicon",ACTIVITYINSTANCE:"."+o.ACTIVITYINSTANCE,ACTIVITYLINK:"."+o.ACTIVITYINSTANCE+" > a, ."+o.ACTIVITYINSTANCE+" > span[data-inplaceeditable] > a:not([data-inplaceeditablelink])",ACTIVITYLI:"li.activity",COMMANDSPAN:".commands",CONTENTAFTERLINK:"div.contentafterlink",CONTENTWITHOUTLINK:"div.contentwithoutlink",GROUPINGLABEL:"."+o.ACTIVITYINSTANCE+" .groupinglabel",HIDE:"a.editing_hide",HIGHLIGHT:"a.editing_highlight",INSTANCENAME:"span.instancename",MODINDENTDIV:".mod-indent",MODINDENTOUTER:".mod-indent-outer",PAGECONTENT:"body",SECTIONLI:"li.section",SHOW:"a."+o.SHOW,SHOWHIDE:"a.editing_showhide"},s={MIN:0,MAX:16},n=e.one(document.body);M.course=M.course||{};var a=function(){a.superclass.constructor.apply(this,arguments)};e.extend(a,e.Base,{send_request:function(t,o,i,s){t||(t={});var n,a=this.get("config").pageparams;for(n in a)t[n]=a[n];t.sesskey=M.cfg.sesskey,t.courseId=this.get("courseid");var r=M.cfg.wwwroot+this.get("ajaxurl"),c=[],l={method:"POST",data:t,on:{success:function(t,s){try{c=e.JSON.parse(s.responseText),c.error&&new M.core.ajaxException(c)}catch(n){}i&&e.bind(i,this,c)(),o&&window.setTimeout(function(){o.hide()},400)},failure:function(e,t){o&&o.hide(),new M.core.ajaxException(t)}},context:this};if(s)for(n in s)l[n]=s[n];return o&&o.show(),e.io(r,l),this}},{NAME:"course-toolbox",ATTRS:{courseid:{value:0},format:{value:"topics"},ajaxurl:{value:null},config:{value:{}}}});var r=function(){r.superclass.constructor.apply(this,arguments)};e.extend(r,a,{GROUPS_NONE:0,GROUPS_SEPARATE:1,GROUPS_VISIBLE:2,initializer:function(){M.course.coursebase.register_module(this),n.delegate("key",this.handle_data_action,"down:enter",i.ACTIVITYACTION,this),e.delegate("click",this.handle_data_action,n,i.ACTIVITYACTION,this)},handle_data_action:function(e){var t=e.target;t.test("a")||(t=t.ancestor(i.ACTIVITYACTION));var o=t.getData("action"),s=t.ancestor(i.ACTIVITYLI);if(t.test("a")&&o&&s)switch(o){case"moveleft":case"moveright":this.change_indent(e,t,s,o);break;case"delete":this.delete_with_confirmation(e,t,s,o);break;case"duplicate":this.duplicate(e,t,s,o);break;case"hide":case"show":this.change_visibility(e,t,s,o);break;case"groupsseparate":case"groupsvisible":case"groupsnone":this.change_groupmode(e,t,s,o);break;case"move":case"update":case"assignroles":}},add_spinner:function(t){var o=t.one(i.ACTIONAREA);return o?M.util.add_spinner(e,o):null},change_indent:function(t,n,a,r){t.preventDefault();var c,l="moveleft"===r?-1:1,u=a.one(i.MODINDENTDIV),d=u.getAttribute("class").match(/mod-indent-(\d{1,})/),I=0;if(d&&(I=parseInt(d[1],10)),c=I+parseInt(l,10),!(c<s.MIN||c>s.MAX)){d&&u.removeClass(d[0]),u.addClass(o.MODINDENTCOUNT+c);var g={"class":"resource",field:"indent",value:c,id:e.Moodle.core_course.util.cm.getId(a)},h=this.add_spinner(a);this.send_request(g,h);var m;c===s.MIN?(n.addClass("hidden"),m=a.one(".editing_moveright")):c>s.MIN&&I===s.MIN&&n.ancestor(".menu").one("[data-action=moveleft]").removeClass("hidden"),c===s.MAX?(n.addClass("hidden"),m=a.one(".editing_moveleft")):c<s.MAX&&I===s.MAX&&n.ancestor(".menu").one("[data-action=moveright]").removeClass("hidden");var T=u.hasClass(o.MODINDENTHUGE);c>15&&!T?u.addClass(o.MODINDENTHUGE):15>=c&&T&&u.removeClass(o.MODINDENTHUGE),t.type&&"key"===t.type&&m&&m.focus()}},delete_with_confirmation:function(t,o,i){t.preventDefault();var s=i,n="",a={type:M.util.get_string("pluginname",s.getAttribute("class").match(/modtype_([^\s]*)/)[1])};null!==e.Moodle.core_course.util.cm.getName(s)?(a.name=e.Moodle.core_course.util.cm.getName(s),n=M.util.get_string("deletechecktypename","moodle",a)):n=M.util.get_string("deletechecktype","moodle",a);var r=new M.core.confirm({question:n,modal:!0,visible:!1});return r.show(),r.on("complete-yes",function(){s.remove();var o={"class":"resource",action:"DELETE",id:e.Moodle.core_course.util.cm.getId(s)};this.send_request(o),M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu(t)},this),this},duplicate:function(t,o,i){t.preventDefault();var s=i,n=i.ancestor(M.course.format.get_section_selector(e)),a=M.util.add_lightbox(e,n).show(),r={"class":"resource",field:"duplicate",id:e.Moodle.core_course.util.cm.getId(s),sr:o.getData("sr")};return this.send_request(r,a,function(t){var o=e.Node.create(t.fullcontent);i.insert(o,"after"),e.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource",o)}),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(o)}),this},change_visibility:function(t,o,i,s){t.preventDefault();var n=i,a=this.handle_resource_dim(o,i,s),r={"class":"resource",field:"visible",value:a,id:e.Moodle.core_course.util.cm.getId(n)},c=this.add_spinner(n);return this.send_request(r,c),this},handle_resource_dim:function(t,s,n){var a=o.DIMCLASS,r=s.one([i.ACTIVITYLINK,i.CONTENTWITHOUTLINK].join(", ")),c=s.one(o.AVAILABILITYINFODIV),l="hide"===n?"show":"hide",u=t.one("span"),d=M.util.get_string(l,"moodle"),I=t.one("img");return I.setAttrs({src:M.util.image_url("t/"+l)}),e.Lang.trim(t.getAttribute("title"))&&t.setAttribute("title",d),e.Lang.trim(I.getAttribute("alt"))&&I.setAttribute("alt",d),t.replaceClass("editing_"+n,"editing_"+l),t.setData("action",l),u&&u.set("text",d),s.one(i.CONTENTWITHOUTLINK)&&(r=s.one(i.CONTENTWITHOUTLINK),a=o.DIMMEDTEXT),r.hasClass(o.CONDITIONALHIDDEN)||("hide"===n?(r.addClass(a),s.all(i.CONTENTAFTERLINK).addClass(o.DIMMEDTEXT),s.all(i.GROUPINGLABEL).addClass(o.DIMMEDTEXT)):(r.removeClass(a),s.all(i.CONTENTAFTERLINK).removeClass(o.DIMMEDTEXT),s.all(i.GROUPINGLABEL).removeClass(o.DIMMEDTEXT))),c&&c.toggleClass(o.HIDE),"hide"===n?0:1},change_groupmode:function(t,o,i){t.preventDefault();var s,n,a,r=parseInt(o.getData("nextgroupmode"),10),c="",l="",u=r+1,d=o.one("img");u>2&&(u=0),r===this.GROUPS_NONE?(c="groupsnone",l=M.util.image_url("i/groupn","moodle")):r===this.GROUPS_SEPARATE?(c="groupsseparate",l=M.util.image_url("i/groups","moodle")):r===this.GROUPS_VISIBLE&&(c="groupsvisible",l=M.util.image_url("i/groupv","moodle")),s=M.util.get_string("clicktochangeinbrackets","moodle",M.util.get_string(c,"moodle"));var I=o.getData("action");return o.replaceClass("editing_"+I,"editing_"+c),d.setAttrs({src:l}),e.Lang.trim(o.getAttribute("title"))&&o.setAttribute("title",s).setData("action",c).setData("nextgroupmode",u),e.Lang.trim(d.getAttribute("alt"))&&d.setAttribute("alt",s),n={"class":"resource",field:"groupmode",value:r,id:e.Moodle.core_course.util.cm.getId(i)},a=this.add_spinner(i),this.send_request(n,a),this},set_visibility_resource_ui:function(e){var t=e.element,o=t.one(i.HIDE),s=!0,n=!1;if(o||(o=t.one(i.SHOW),s=!1,n=!0),"undefined"!=typeof e.visible&&(n=e.visible),s!==n){var a="hide";n&&(a="show"),this.handle_resource_dim(o,t,a)}}},{NAME:"course-resource-toolbox",ATTRS:{}}),M.course.resource_toolbox=null,M.course.init_resource_toolbox=function(e){return M.course.resource_toolbox=new r(e),M.course.resource_toolbox};var c=function(){c.superclass.constructor.apply(this,arguments)};e.extend(c,a,{initializer:function(){M.course.coursebase.register_module(this),e.delegate("click",this.toggle_highlight,i.PAGECONTENT,i.SECTIONLI+" "+i.HIGHLIGHT,this),e.delegate("click",this.toggle_hide_section,i.PAGECONTENT,i.SECTIONLI+" "+i.SHOWHIDE,this)},toggle_hide_section:function(t){t.preventDefault();var s,n,a,r=t.target.ancestor(M.course.format.get_section_selector(e)),c=t.target.ancestor("a",!0),l=c.one("img"),u=c.one("span");r.hasClass(o.SECTIONHIDDENCLASS)?(r.removeClass(o.SECTIONHIDDENCLASS),s=1,n="show",a="hide"):(r.addClass(o.SECTIONHIDDENCLASS),s=0,n="hide",a="show");var d=M.util.get_string(a+"fromothers","format_"+this.get("format"));l.setAttrs({alt:d,src:M.util.image_url("i/"+a)}),c.set("title",d),u&&u.set("text",d);var I={"class":"section",field:"visible",id:e.Moodle.core_course.util.section.getId(r.ancestor(M.course.format.get_section_wrapper(e),!0)),value:s},g=M.util.add_lightbox(e,r);g.show(),this.send_request(I,g,function(t){var o=r.all(i.ACTIVITYLI);o.each(function(o){var s;s=o.one(i.SHOW)?o.one(i.SHOW):o.one(i.HIDE);var a=e.Moodle.core_course.util.cm.getId(o);-1!==e.Array.indexOf(t.resourcestotoggle,""+a)&&M.course.resource_toolbox.handle_resource_dim(s,o,n)},this)}),1==I.value&&this.bpm_should_send_student_notice(I)},toggle_highlight:function(t){t.preventDefault();var o=t.target.ancestor(M.course.format.get_section_selector(e)),s=t.target.ancestor("a",!0),n=s.one("img"),a=s.one("span"),r=o.hasClass("current"),c=0,l=M.util.get_string("markthistopic","moodle"),u=e.one(i.PAGECONTENT);if(u.all(M.course.format.get_section_selector(e)+".current "+i.HIGHLIGHT).set("title",l),u.all(M.course.format.get_section_selector(e)+".current "+i.HIGHLIGHT+" span").set("text",M.util.get_string("highlight","moodle")),u.all(M.course.format.get_section_selector(e)+".current "+i.HIGHLIGHT+" img").set("alt",l).set("src",M.util.image_url("i/marker")),u.all(M.course.format.get_section_selector(e)).removeClass("current"),!r){o.addClass("current"),c=e.Moodle.core_course.util.section.getId(o.ancestor(M.course.format.get_section_wrapper(e),!0));var d=M.util.get_string("markedthistopic","moodle");s.set("title",d),n.set("alt",d).set("src",M.util.image_url("i/marked")),a&&a.set("text",M.util.get_string("highlightoff","moodle"))}var I={"class":"course",field:"marker",value:c},g=M.util.add_lightbox(e,o);g.show(),this.send_request(I,g)},bpm_should_send_student_notice:function(e){var t=$('<div id="revealDialogElement"/>'),o={autoOpen:!1,draggable:!1,modal:!0,title:"התראה לסטודנטים",closeOnEscape:!1,classes:{"ui-dialog":"ui-dialog ui-corner-all ui-widget ui-widget-content ui-front ui-dialog-buttons ui-resizable tn-dialog"},open:function(){$(this).html("האם לשלוח התראה לסטודנטים על חשיפת התוכן?")},buttons:[{text:"כן",click:function(){$(this).dialog("close"),$.post("https://my.bpm-music.com/blocks/bpm_utils/student_content_notice.php",{sectionId:e.id,courseId:e.courseId}).done(function(){alert("נשלחה התראה לסטודנטים")})}},{text:"לא",click:function(){$(this).dialog("close")}}]};t.dialog(o).dialog("open")}},{NAME:"course-section-toolbox",ATTRS:{}}),M.course.init_section_toolbox=function(e){return new c(e)}},"@VERSION@",{requires:["node","base","event-key","node","io","moodle-course-coursebase","moodle-course-util"]});